name: deploy-binboi

on:
  push:
    branches:
    - master

env:
  FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}

jobs:
  test-backboi:
    uses: fuz95esi/binboi/.github/workflows/reusable-test-backboi.yaml@master
  test-frontboi:
    uses: fuz95esi/binboi/.github/workflows/reusable-test-frontboi.yaml@master
  deploy:
    name: Deploy components
    strategy:
      matrix:
        include:
          - component: backboi
            required_worklows: [ test-backboi ]
          - component: frontboi
            required_worklows: [ test-frontboi ]
    defaults:
        run:
          working-directory: ${{ matrix.component }}
    runs-on: ubuntu-latest
    needs: ${{ matrix.required_workflows }}
    steps:
      - uses: actions/checkout@v2
      - uses: superfly/flyctl-actions/setup-flyctl@master
      - run: flyctl deploy --remote-only
